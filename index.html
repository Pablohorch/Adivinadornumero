<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Adivina el número</title>
<style>
  /* Mobile-first, one-column layout */
  body { font-family: system-ui, sans-serif; margin: 0; padding: 1rem; line-height: 1.5; }
  main { max-width: 400px; margin: 0 auto; display: flex; flex-direction: column; gap: 1rem; }
  button, input { font-size: 1rem; padding: 0.75rem; min-height: 44px; }
  button:disabled { opacity: 0.5; }
  button:focus, input:focus { outline: 2px solid #005fcc; outline-offset: 2px; }
  .feedback { min-height: 1.5em; }
</style>
</head>
<body>
<main>
  <h1>Adivina el número</h1>
  <button id="generateBtn" type="button">Generar número</button>
  <form id="guessForm" autocomplete="off">
    <label for="guessInput">Introduce tu número…</label>
    <input id="guessInput" type="text" inputmode="numeric" pattern="[0-9.]*" placeholder="Introduce tu número…">
    <button id="sendBtn" type="submit" disabled aria-disabled="true">Enviar</button>
  </form>
  <output id="feedback" aria-live="polite" class="feedback"></output>
  <p id="attempts">Intentos: 0</p>
  <p id="range">Menor: 1 | Mayor: 3.000.000.000</p>
  <h2>Historial de intentos</h2>
  <ul id="history"></ul>
  <button id="resetBtn" type="button">Reiniciar</button>
</main>
<script>
// Lógica del juego de adivinar el número
(function() {
  const max = 3000000000;
  let secret = null;
  let attempts = 0;
  const generateBtn = document.getElementById('generateBtn');
  const guessInput = document.getElementById('guessInput');
  const sendBtn = document.getElementById('sendBtn');
  const resetBtn = document.getElementById('resetBtn');
  const feedback = document.getElementById('feedback');
  const attemptsText = document.getElementById('attempts');
  const rangeText = document.getElementById('range');
  const historyList = document.getElementById('history');
  const form = document.getElementById('guessForm');
  let lowerBound = 1;
  let upperBound = max;

  function formatNumber(n) {
    return n.toLocaleString('es-ES');
  }

  function updateRangeText() {
    const minText = formatNumber(lowerBound);
    const maxText = formatNumber(upperBound);
    rangeText.textContent = 'Menor: ' + minText + ' | Mayor: ' + maxText;
  }

  updateRangeText();

  // Habilita o deshabilita el botón Enviar según la entrada y si existe número secreto
  function updateSendState() {
    const raw = guessInput.value.trim().replace(/\./g, '');
    const isValid = secret !== null && raw !== '' &&
                    /^\d+$/.test(raw) && (n => n >= 1 && n <= max)(Number(raw));
    sendBtn.disabled = !isValid;
    sendBtn.setAttribute('aria-disabled', String(sendBtn.disabled));
    return isValid;
  }

  // Genera el número secreto
  function generateSecret() {
    if (window.crypto && crypto.getRandomValues) {
      const arr = new Uint32Array(1);
      crypto.getRandomValues(arr);
      secret = arr[0] % max + 1;
    } else {
      secret = Math.floor(Math.random() * max) + 1;
    }
    generateBtn.disabled = true;
    generateBtn.setAttribute('aria-disabled', 'true');
    attempts = 0;
    attemptsText.textContent = 'Intentos: 0';
    feedback.textContent = '';
    guessInput.value = '';
    sendBtn.disabled = true;
    sendBtn.setAttribute('aria-disabled', 'true');
    lowerBound = 1;
    upperBound = max;
    historyList.innerHTML = '';
    updateRangeText();
    guessInput.focus();
  }

  // Comprueba el intento del usuario
  function handleGuess() {
    if (!updateSendState()) return;
    const guess = Number(guessInput.value.replace(/\./g, ''));
    attempts++;
    attemptsText.textContent = 'Intentos: ' + attempts;
    let hint = '';
    if (guess === secret) {
      hint = 'Correcto';
      feedback.textContent = hint;
    } else if (guess < secret) {
      lowerBound = Math.max(lowerBound, guess);
      hint = 'Mayor';
      feedback.textContent = hint;
    } else {
      upperBound = Math.min(upperBound, guess);
      hint = 'Menor';
      feedback.textContent = hint;
    }
    updateRangeText();
    const li = document.createElement('li');
    li.textContent = formatNumber(guess) + ' → ' + hint;
    historyList.appendChild(li);
    guessInput.value = '';
    updateSendState();
  }

  // Reinicia el juego
  function resetGame() {
    secret = null;
    attempts = 0;
    attemptsText.textContent = 'Intentos: 0';
    feedback.textContent = '';
    guessInput.value = '';
    generateBtn.disabled = false;
    generateBtn.setAttribute('aria-disabled', 'false');
    sendBtn.disabled = true;
    sendBtn.setAttribute('aria-disabled', 'true');
    lowerBound = 1;
    upperBound = max;
    historyList.innerHTML = '';
    updateRangeText();
  }

  // Valida la entrada en cada cambio
  guessInput.addEventListener('input', () => {
    const digits = guessInput.value.replace(/\D/g, '');
    if (digits === '') {
      guessInput.value = '';
      feedback.textContent = '';
    } else {
      guessInput.value = formatNumber(Number(digits));
      const number = Number(digits);
      if (number < 1 || number > max) {
        feedback.textContent = 'Fuera de rango';
      } else {
        feedback.textContent = '';
      }
    }
    updateSendState();
  });

  generateBtn.addEventListener('click', generateSecret);
  resetBtn.addEventListener('click', resetGame);
  form.addEventListener('submit', function(e) {
    e.preventDefault();
    if (!sendBtn.disabled) handleGuess();
  });
})();
</script>
</body>
</html>
