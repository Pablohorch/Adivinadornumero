<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Adivina el número</title>
<style>
  /* Diseño responsive y atractivo */
  body {
    font-family: system-ui, sans-serif;
    margin: 0;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    background: linear-gradient(135deg, #4e54c8, #8f94fb);
    color: #333;
  }

  main {
    width: 100%;
    max-width: 480px;
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    padding: 1.5rem;
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  h1 {
    text-align: center;
    margin: 0;
  }

  form {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    width: 100%;
  }

  .button-row {
    display: flex;
    gap: 0.5rem;
  }

  button,
  input {
    font-size: 1rem;
    padding: 0.75rem;
    min-height: 44px;
    border-radius: 8px;
    border: 1px solid #ccc;
  }

  button {
    background-color: #4e54c8;
    color: #fff;
    border: none;
    cursor: pointer;
  }

  button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  button:focus,
  input:focus {
    outline: 2px solid #005fcc;
    outline-offset: 2px;
  }

  #guessInput {
    width: 100%;
    box-sizing: border-box;
  }

  .feedback {
    min-height: 1.5em;
  }
</style>
</head>
<body>
<main>
  <h1>Adivina el número</h1>
  <button id="generateBtn" type="button">Generar número</button>
  <form id="guessForm" autocomplete="off">
    <label for="guessInput">Introduce tu número…</label>
    <input id="guessInput" type="text" inputmode="numeric" pattern="[0-9.]*" placeholder="Introduce tu número…">
      <div class="button-row">
        <button id="preFillBtn" type="button" disabled aria-disabled="true">PreEscribir</button>
        <button id="fillBtn" type="button">Rellenar</button>
        <button id="sendBtn" type="submit" disabled aria-disabled="true">Enviar</button>
      </div>
      </form>
      <output id="feedback" aria-live="polite" class="feedback"></output>
      <p id="attempts">Intentos: 0</p>
  <p id="range">Menor: 1 | Mayor: 3.000.000.000</p>
  <h2>Historial de intentos</h2>
  <ul id="history"></ul>
  <button id="resetBtn" type="button">Reiniciar</button>
</main>
<script>
// Lógica del juego de adivinar el número
(function() {
  const max = 3000000000;
  let secret = null;
  let attempts = 0;
  const generateBtn = document.getElementById('generateBtn');
  const guessInput = document.getElementById('guessInput');
  const sendBtn = document.getElementById('sendBtn');
  const preFillBtn = document.getElementById('preFillBtn');
  const fillBtn = document.getElementById('fillBtn');
  const resetBtn = document.getElementById('resetBtn');
  const feedback = document.getElementById('feedback');
  const attemptsText = document.getElementById('attempts');
  const rangeText = document.getElementById('range');
  const historyList = document.getElementById('history');
  const form = document.getElementById('guessForm');
  let lowerBound = 1;
  let upperBound = max;
  let commonPrefix = '';

  function formatNumber(n) {
    return n.toLocaleString('es-ES');
  }

  function boldCommonDigits(text, prefixLen) {
    let result = '';
    let count = 0;
    let opened = false;
    for (const ch of text) {
      if (ch === '.') {
        result += ch;
      } else {
        if (count === 0 && prefixLen > 0) {
          result += '<b>';
          opened = true;
        }
        result += ch;
        count++;
        if (count === prefixLen && opened) {
          result += '</b>';
          opened = false;
        }
      }
    }
    if (opened) result += '</b>';
    return result;
  }

  function updateRangeText() {
    const minText = formatNumber(lowerBound);
    const maxText = formatNumber(upperBound);
    const minRaw = String(lowerBound);
    const maxRaw = String(upperBound);
    let prefixLen = 0;
    while (minRaw[prefixLen] && minRaw[prefixLen] === maxRaw[prefixLen]) prefixLen++;
    commonPrefix = minRaw.slice(0, prefixLen);
    const minHTML = boldCommonDigits(minText, prefixLen);
    const maxHTML = boldCommonDigits(maxText, prefixLen);
    rangeText.innerHTML = 'Menor: ' + minHTML + ' | Mayor: ' + maxHTML;
    const enablePre = prefixLen > 0;
    preFillBtn.disabled = !enablePre;
    preFillBtn.setAttribute('aria-disabled', String(!enablePre));
  }

  updateRangeText();

  // Habilita o deshabilita el botón Enviar según la entrada y si existe número secreto
    function updateSendState() {
    const raw = guessInput.value.trim().replace(/\./g, '');
    const isValid = secret !== null && raw !== '' &&
                    /^\d+$/.test(raw) && (n => n >= 1 && n <= max)(Number(raw));
    sendBtn.disabled = !isValid;
    sendBtn.setAttribute('aria-disabled', String(sendBtn.disabled));
    return isValid;
  }

  // Genera el número secreto
  function generateSecret() {
    if (window.crypto && crypto.getRandomValues) {
      const arr = new Uint32Array(1);
      crypto.getRandomValues(arr);
      secret = arr[0] % max + 1;
    } else {
      secret = Math.floor(Math.random() * max) + 1;
    }
    generateBtn.disabled = true;
    generateBtn.setAttribute('aria-disabled', 'true');
    attempts = 0;
    attemptsText.textContent = 'Intentos: 0';
    feedback.textContent = '';
    guessInput.value = '';
    sendBtn.disabled = true;
    sendBtn.setAttribute('aria-disabled', 'true');
    lowerBound = 1;
    upperBound = max;
    historyList.innerHTML = '';
    updateRangeText();
    guessInput.focus();
  }

  // Comprueba el intento del usuario
  function handleGuess() {
    if (!updateSendState()) return;
    const guess = Number(guessInput.value.replace(/\./g, ''));
    attempts++;
    attemptsText.textContent = 'Intentos: ' + attempts;
    let hint = '';
    if (guess === secret) {
      hint = 'Correcto';
      feedback.textContent = hint;
    } else if (guess < secret) {
      lowerBound = Math.max(lowerBound, guess);
      hint = 'Mayor';
      feedback.textContent = hint;
    } else {
      upperBound = Math.min(upperBound, guess);
      hint = 'Menor';
      feedback.textContent = hint;
    }
    updateRangeText();
    const li = document.createElement('li');
    li.textContent = formatNumber(guess) + ' → ' + hint;
    historyList.appendChild(li);
    guessInput.value = '';
    updateSendState();
  }

  // Reinicia el juego
  function resetGame() {
    secret = null;
    attempts = 0;
    attemptsText.textContent = 'Intentos: 0';
    feedback.textContent = '';
    guessInput.value = '';
    generateBtn.disabled = false;
    generateBtn.setAttribute('aria-disabled', 'false');
    sendBtn.disabled = true;
    sendBtn.setAttribute('aria-disabled', 'true');
    lowerBound = 1;
    upperBound = max;
    historyList.innerHTML = '';
    updateRangeText();
  }

  // Valida la entrada en cada cambio
  guessInput.addEventListener('input', () => {
    const digits = guessInput.value.replace(/\D/g, '');
    if (digits === '') {
      guessInput.value = '';
      feedback.textContent = '';
    } else {
      guessInput.value = formatNumber(Number(digits));
      const number = Number(digits);
      if (number < 1 || number > max) {
        feedback.textContent = 'Fuera de rango';
      } else {
        feedback.textContent = '';
      }
    }
    updateSendState();
  });

  preFillBtn.addEventListener('click', () => {
    if (commonPrefix !== '') {
      guessInput.value = formatNumber(Number(commonPrefix));
      feedback.textContent = '';
      updateSendState();
      guessInput.focus();
    }
  });

  fillBtn.addEventListener('click', () => {
    const raw = guessInput.value.trim().replace(/\./g, '');
    if (raw === '') return;
    const maxDigits = String(upperBound).length;
    const padded = raw.padEnd(maxDigits, '0');
    guessInput.value = formatNumber(Number(padded));
    feedback.textContent = '';
    updateSendState();
    guessInput.focus();
  });

  generateBtn.addEventListener('click', generateSecret);
  resetBtn.addEventListener('click', resetGame);
  form.addEventListener('submit', function(e) {
    e.preventDefault();
    if (!sendBtn.disabled) handleGuess();
  });
})();
</script>
</body>
</html>
